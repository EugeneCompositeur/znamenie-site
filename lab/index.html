<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Храм Знамения Пресвятой Богородицы в Париже</title>

  <!-- SEO -->
  <meta name="description" content="Официальный сайт Храма Знамения Пресвятой Богородицы в Париже. Православное расписание богослужений, адрес, контакты. Église Orthodoxe Notre-Dame Du Signe à Paris." />
  <meta name="keywords" content="храм, православие, Париж, Богородица, Église Orthodoxe, Notre-Dame du Signe, Paris, богослужение, расписание, православный приход, церковь" />
  <link rel="alternate" href="https://znamenie.fr/" hreflang="ru" />
  <link rel="alternate" href="https://znamenie.fr/" hreflang="fr" />
  <link rel="alternate" href="https://znamenie.fr/" hreflang="be" />
  <link rel="alternate" href="https://znamenie.fr/" hreflang="uk" />
  <meta property="og:title" content="Храм Знамения Пресвятой Богородицы в Париже" />
  <meta property="og:description" content="Официальный сайт прихода. Актуальное расписание богослужений, контакты, адрес." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://znamenie.fr/" />
  <meta property="og:image" content="https://znamenie.fr/assets/icon.gif" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Храм Знамения Пресвятой Богородицы в Париже" />
  <meta name="twitter:description" content="Официальный сайт прихода. Актуальное расписание богослужений, контакты, адрес." />
  <meta name="twitter:image" content="https://znamenie.fr/assets/icon.gif" />

  <link rel="icon" href="assets/icon.gif" type="image/gif" />
  <link href="https://fonts.googleapis.com/css2?family=Forum&family=Open+Sans&family=Roboto+Mono&display=swap" rel="stylesheet" />
  <style>
    :root{
      --bg:#ede6d9;
      --ink:#2f2f2f;
      --gold:#a2906f;
      --card-max:1040px;
      --gap:18px;
    }

    body { margin:0; padding:0; background:var(--bg); font-family:'Open Sans',sans-serif; color:var(--ink); text-align:center; }
    .overlay { padding:2rem 1rem 3rem; max-width:var(--card-max); margin:auto; position:relative; }

    /* языки */
    .lang-switch { position:absolute; top:1rem; right:1rem; font-size:.9em; display:flex; gap:.8em; z-index:100; }
    .lang-switch span { cursor:pointer; color:#666; font-weight:600; letter-spacing:.1em; padding:.1em .2ем; border-radius:2px; }
    .lang-switch span.active { color:#2f2f2f; font-weight:700; }
    .lang-switch span:hover { color:#a2906f; }

    /* шапка */
    header { display:flex; flex-direction:column; align-items:center; margin-bottom:1.5rem; position:relative; }
    .logo-block { display:flex; flex-direction:row; justify-content:space-between; width:100%; align-items:center; }
    .logo-text { display:flex; flex-direction:column; justify-content:center; font-family:'Forum',serif; font-size:2.4em; flex:1; }
    .logo-text.left { text-align:right; } .logo-text.right { text-align:left; }
    .logo-text span { display:block; }
    .logo-block img { height:140px; margin:0 1em; }
    .subheading { font-size:1em; margin-top:.6rem; font-family:'Forum',serif; }

    /* сетка */
    .content { display:grid; grid-template-columns: repeat(12, minmax(0, 1fr)); gap:var(--gap); align-items:start; }
    .schedule-wrap { grid-column: 1 / -1; }

    /* расписание — компактно, вровень с карточками */
    .schedule{
      position:relative;
      text-align:left;
      background:#fff;
      padding:.9em 1.1em 2.2em 1.1em; /* место под стрелку */
      border-radius:8px;
      font-size:1em;
      margin:0;
      width:auto;
      max-width:100%;
      box-sizing:border-box;
      cursor:pointer; user-select:none; min-width:0;
    }
    .schedule::before{
      content:""; position:absolute; top:10px; left:10px; right:10px; bottom:10px;
      border:3px double var(--gold); pointer-events:none; border-radius:8px; box-sizing:border-box;
    }
    .schedule-label, .schedule-month { font-family:'Forum',serif; font-weight:bold; text-align:center; }
    .schedule-label { font-size:1.28em; margin:.4em 0 .75em 0; }
    .schedule-month { font-size:1.2em; letter-spacing:.02em; margin:.35em 0 .25em 0; }
    .schedule ul { margin:.1em 0 .75em 1.4em; padding:0; }
    .schedule ul li, .schedule ul li *{ margin:.2em 0; text-decoration:none !important; }

    /* стрелка — внутри, без рамок/анимации, в цвет двойной линии */
    .chevron{
      position:absolute; left:50%; bottom:10px; transform:translate(-50%, 50%);
      font-size:.6rem; line-height:1; color:var(--gold);
      pointer-events:none; background:#fff; padding:0 .15em;
    }

    /* карточки */
    .cards { grid-column: 1 / -1; display:grid; grid-template-columns: repeat(3, 1fr); gap:var(--gap); margin-top:1.2rem; }
    .card {
      background:#fff; border-radius:8px; overflow:hidden; text-align:left;
      transition:transform .15s ease, box-shadow .15s ease;
      box-shadow:0 1px 0 rgba(0,0,0,.02);
    }
    .card:focus, .card:hover { transform:translateY(-2px); box-shadow:0 6px 16px rgba(0,0,0,.08); outline:none; }
    .card:focus-visible{ outline:2px dashed var(--gold); outline-offset:3px; }

    /* Квадратная медиазона карточки — всегда 1:1 */
    .card-media{ position:relative; width:100%; aspect-ratio:1/1; }
    @supports not (aspect-ratio: 1 / 1){
      .card-media::before{ content:""; display:block; padding-top:100%; }
    }
    .card-media .media-inner{ position:absolute; inset:0; }
    .card-media picture, .card-media img{ width:100%; height:100%; display:block; object-fit:cover; }

    .card .card-body { padding:.8rem .9rem 1rem; }
    .card h3 { margin:0 0 .35rem 0; font-family:'Forum',serif; font-size:1.15rem; }
    .card p { margin:0; font-size:.95rem; line-height:1.35; color:#464646; }

    /* ==== MODAL: скролл всего окна + фото слева меньше + "Читать полностью" ==== */
    .modal{
      position: fixed; inset: 0;
      display: none;
      align-items: flex-start;            /* выглядим как «лист» */
      justify-content: center;
      background: rgba(0,0,0,.5);
      overflow-y: auto;                   /* скролл у всего оверлея */
      -webkit-overflow-scrolling: touch;
      z-index: 1000;
    }
    .modal.open{ display:flex; }
    body.modal-open{ overflow: hidden; }

    .modal-dialog{
      background: #fff;
      border-radius: 12px;
      width: 92vw; max-width: min(1000px, 92vw);
      height: auto; max-height: none;
      margin: 4vh auto;
      display: flex; flex-direction: column;
      overflow: visible;
      box-shadow: 0 20px 40px rgba(0,0,0,.25);
    }
    .modal-header{ display:flex; align-items:center; justify-content:space-between; padding:.75rem 1rem; border-bottom:1px solid rgba(0,0,0,.08); }
    .modal-title{ font-family:'Forum',serif; font-size:1.4rem; margin:0; }
    .modal-close{ background:none; border:none; font-size:1.3rem; line-height:1; cursor:pointer; padding:.25rem .4rem; }
    .modal-close:focus{ outline:2px dashed var(--gold); outline-offset:3px; }

    .modal-hero{ display:none; } /* верхний hero не нужен */
    .modal-body{ padding: 1rem 1rem 1.4rem; overflow: visible; text-align: left; flex: 1 1 auto; }
    .modal-body p{ margin:.6rem 0; line-height:1.5; }

    /* фото слева с обтеканием, уменьшено примерно на треть */
    .lead-figure{
      float: left;
      width: min(28%, 300px);
      margin: 0 1.1rem .6rem 0;
      border-radius: 8px; overflow: hidden;
    }
    .lead-figure picture, .lead-figure img{ display:block; width:100%; height:auto; object-fit:cover; }

    /* "Читать полностью" */
    .read-more{ margin: 1.2rem 0 0; text-align:center; }
    .read-more a{
      font-family:'Forum',serif;
      text-decoration:none;
      border-bottom:1px dashed rgba(0,0,0,.35);
      padding-bottom:.05rem; color:#2f2f2f;
    }
    .read-more a:hover{ color:#a2906f; border-bottom-color:#a2906f; }

    @media (max-width:900px){
      .logo-block img{height:120px}
      .cards{grid-template-columns:repeat(2,1fr)}
    }
    @media (max-width:640px){
      .logo-block{flex-direction:column;text-align:center}
      .logo-text.left,.logo-text.right{text-align:center}
      .logo-block img{margin:1em 0}
      .cards{grid-template-columns:1fr}
      .modal-dialog{ width:100vw; max-width:100vw; margin:0; border-radius:0; }
      .lead-figure{ float:none; width:auto; margin:0 0 .8rem 0; } /* фото сверху */
    }

    /* футер */
    .footer { margin-top:2rem; font-size:.92em; color:#555; }
    .footer .admin-gear { text-decoration:none; margin-left:.35em; font-size:1em; color:#666; padding:.05em .35em; border-radius:6px; }
    .footer .admin-gear:hover { background:rgba(0,0,0,.06); color:#2f2f2f; }
  </style>
</head>
<body>
  <div class="overlay">

    <div class="lang-switch" role="group" aria-label="Переключение языков">
      <span class="active" data-lang="ru">RU</span>
      <span data-lang="fr">FR</span>
      <span data-lang="by">BY</span>
      <span data-lang="ua">UA</span>
    </div>

    <header>
      <div class="logo-block">
        <div class="logo-text left" id="logo-left">
          <span>Храм</span>
          <span>Знамения</span>
        </div>
        <img src="assets/icon.gif" alt="Икона Богородицы" />
        <div class="logo-text right" id="logo-right">
          <span>Пресвятой</span>
          <span>Богородицы</span>
        </div>
      </div>
      <div class="subheading" id="subheading">
        Викариат имени Святых Марии Парижской и Алексия Южинского — Вселенский Патриархат
      </div>
    </header>

    <main class="content">
      <!-- ===== Расписание ===== -->
      <section class="schedule-wrap">
        <div class="schedule" id="schedule-box" role="button" tabindex="0" aria-expanded="false" aria-label="Показать всё расписание">
          <div class="schedule-label" id="schedule-label-1">Расписание богослужений</div>
          <div class="schedule-month" id="current-label">ИЮЛЬ</div>
          <ul id="schedule-compact"></ul>

          <!-- Полный режим -->
          <div class="schedule-month" id="month-a" style="display:none;"></div>
          <ul id="list-a" style="display:none;"></ul>
          <div class="schedule-month" id="month-b" style="display:none;"></div>
          <ul id="list-b" style="display:none;"></ul>

          <div class="chevron" id="chevron">▼</div>
        </div>
      </section>

      <!-- ===== Карточки ===== -->
      <section class="cards" aria-label="Разделы сайта" id="cards"></section>
    </main>

    <div class="footer" id="footer">
      87, boulevard Exelmans, Paris 75016<br />
      Métро: Exelmans (ligne 9)<br />
      ✉️ <a id="email" href="mailto:ndsigne@gmail.com">ndsigne@gmail.com</a>
    </div>
  </div>

  <!-- Модал карточки -->
  <div class="modal" id="card-modal" aria-hidden="true" aria-labelledby="modal-title" role="dialog">
    <div class="modal-dialog" role="document">
      <header class="modal-header">
        <h2 class="modal-title" id="modal-title"></h2>
        <button class="modal-close" id="modal-close" aria-label="Закрыть">×</button>
      </header>
      <div class="modal-hero" id="modal-hero"></div>
      <div class="modal-body" id="modal-body"></div>
    </div>
  </div>

  <script>
    /* ===================== Переводы (краткие анонсы + карточки) ===================== */
    const translations = {
      ru: {
        logoLeft: ["Храм","Знамения"],
        logoRight: ["Пресвятой","Богородицы"],
        subheading: "Викариат имени Святых Марии Парижской и Алексия Южинского — Вселенский Патриархат",
        scheduleLabel1: "Расписание богослужений",
        currentLabel: "СЕНТЯБРЬ",
        scheduleCurrent: [
          "<strong>6 суббота, 18:00</strong>&nbsp;&ndash; Всенощное бдение. 13-я Неделя по Пятидесятнице, глас 4-й",
          "<strong>7 воскресенье, 10:30</strong>&nbsp;&ndash; Литургия. Апостолов Варфоломея и&nbsp;Тита. После литургии – молебен учащимся",
          "<strong>13 суббота, 18:00</strong>&nbsp;&ndash; Всенощное бдение. 14-я Неделя по Пятидесятнице, глас 5-й",
          "<strong>14 воскресенье, 10:30</strong>&nbsp;&ndash; Литургия. Церковное новолетие, прп.&nbsp;Симеон Столпник",
          "<strong>20 суббота, 18:00</strong>&nbsp;&ndash; Всенощное бдение. 15-я Неделя по Пятидесятнице, глас 6-й",
          "<strong>21 воскресенье, 10:30</strong>&nbsp;&ndash; Литургия. Рождество Пресвятой Богородицы",
          "<strong>26 пятница, 18:00</strong>&nbsp;&ndash; Всенощное бдение. Канун Воздвижения Креста Господня",
          "<strong>27 суббота, 10:00</strong>&nbsp;&ndash; Литургия. Воздвижение Честного и Животворящего Креста Господня",
          "<strong>27 суббота, 18:00</strong>&nbsp;&ndash; Всенощное бдение. 16-я Неделя по Пятидесятнице, глас 7-й",
          "<strong>28 воскресенье, 10:30</strong>&nbsp;&ndash; Литургия. Неделя после Воздвижения, вмч.&nbsp;Никиты"
        ],
        nextLabel: "ОКТЯБРЬ",
        scheduleNext: [
          "<strong>4 суббота, 18:00</strong>&nbsp;&ndash; Всенощное бдение. 17-я Неделя по Пятидесятнице, глас 8-й",
          "<strong>5 воскресенье, 10:30</strong>&nbsp;&ndash; Литургия. Апостола Кодрата",
          "<strong>11 суббота, 18:00</strong>&nbsp;&ndash; Всенощное бдение. 18-я Неделя по Пятидесятнице, глас 1-й",
          "<strong>12 воскресенье, 10:30</strong>&nbsp;&ndash; Литургия. Прп.&nbsp;Кириака Отшельника",
          "<strong>13 понедельник, 18:00</strong>&nbsp;&ndash; Всенощное бдение. Канун Покрова Пресвятой Богородицы",
          "<strong>14 вторник, 10:00</strong>&nbsp;&ndash; Литургия. Покров Пресвятой Богородицы",
          "<strong>18 суббота, 18:00</strong>&nbsp;&ndash; Всенощное бдение. 19-я Неделя по Пятидесятнице, глас 2-й",
          "<strong>19 воскресенье, 10:30</strong>&nbsp;&ndash; Литургия. Апостола Фомы",
          "<strong>25 суббота, 18:00</strong>&nbsp;&ndash; Всенощное бдение. 20-я Неделя по Пятидесятнице, глас 3-й",
          "<strong>26 воскресенье, 10:30</strong>&nbsp;&ndash; Литургия. Иверской иконы Божией Матери"
        ],
        cards: [
          { id:"history",  img:"history",  title:"История прихода",  desc:"Как община белой эмиграции стала домом в Париже.",  articleHtml:"<p>Краткий очерк об истории прихода.</p>" },
          { id:"clergy",   img:"clergy",   title:"Клирики храма",    desc:"Настоятель прот. Владимир Ягелло, свящ. Алексей Уминский.",  articleHtml:"<p>Сведения о клире.</p>" },
          { id:"school",   img:"school",   title:"Воскресная школа", desc:"Детские и взрослые группы после литургии.", articleHtml:"<p>О школе и записи.</p>" },
          { id:"icons",    img:"icons",    title:"Иконы",            desc:"Почитаемые образы, молитвы, практика.",      articleHtml:"<p>О святынях храма.</p>" },
          { id:"white",    img:"white",    title:"Белое движение",   desc:"Память Русского исхода и работа с архивами.", articleHtml:"<p>О памяти и проектах.</p>" },
          { id:"library",  img:"library",  title:"Библиотека",       desc:"Фонд, выдача на дом, дарение книг.",          articleHtml:"<p>О фонде библиотеки.</p>" }
        ],
        footer: `87, boulevard Exelmans, Paris 75016<br />Метро: Exelmans (ligne 9)<br />✉️ <a id="email" href="mailto:ndsigne@gmail.com">ndsigne@gmail.com</a>`
      },

      fr: {
        logoLeft: ["Paroisse","Orthodoxe"],
        logoRight: ["Notre-Dame","du Signe"],
        subheading: "Vicariat Sainte-Marie-de-Paris et Saint-Alexis-d’Ugine – Patriarcat Œcuménique",
        scheduleLabel1: "Horaires des offices",
        currentLabel: "SEPTEMBRE",
        scheduleCurrent: [
          "<strong>6 samedi, 18:00</strong>&nbsp;&ndash; Vigiles…",
          "<strong>7 dimanche, 10:30</strong>&nbsp;&ndash; Liturgie…"
        ],
        cards: [
          { id:"history",  img:"history",  title:"Histoire de la paroisse",  desc:"La diaspora russe à Paris.",  articleHtml:"<p>Texte court.</p>" },
          { id:"clergy",   img:"clergy",   title:"Clergé",                   desc:"Recteur et prêtre.",         articleHtml:"<p>Texte court.</p>" },
          { id:"school",   img:"school",   title:"École du dimanche",        desc:"Horaires et groupes.",       articleHtml:"<p>Texte court.</p>" },
          { id:"icons",    img:"icons",    title:"Icônes",                   desc:"Images vénérées.",           articleHtml:"<p>Texte court.</p>" },
          { id:"white",    img:"white",    title:"Mouvement blanc",          desc:"Mémoire de l’exil.",         articleHtml:"<p>Texte court.</p>" },
          { id:"library",  img:"library",  title:"Bibliothèque",             desc:"Catalogue et règles.",       articleHtml:"<p>Texte court.</p>" }
        ],
        footer: `87, boulevard Exelmans, Paris 75016<br />Métро : Exelmans (ligne 9)<br />✉️ <a id="email" href="mailto:ndsigne@gmail.com">ndsigne@gmail.com</a>`
      },

      by: {
        logoLeft: ["Храм","Знамення"],
        logoRight: ["Прасвятой","Багародзіцы"],
        subheading: "Вікарыят імя Святых Марыі Парыжскай і Аляксея Южынскага — Сусветны Патрыярхат",
        scheduleLabel1: "Расклад набажэнстваў",
        currentLabel: "ВЕРАСЕНЬ",
        scheduleCurrent: [
          "<strong>6 субота, 18:00</strong>&nbsp;&ndash; Усяночная…",
          "<strong>7 нядзеля, 10:30</strong>&nbsp;&ndash; Боская Літургія…"
        ],
        cards: [
          { id:"history", img:"history", title:"Гісторыя прыходу", desc:"Руская дыяспара ў Парыжы.", articleHtml:"<p>Кароткі тэкст.</p>" },
          { id:"clergy",  img:"clergy",  title:"Клірыкі храма",    desc:"Настаяцель і святар.",    articleHtml:"<p>Кароткі тэкст.</p>" },
          { id:"school",  img:"school",  title:"Нядзельная школа", desc:"Расклад, групы.",         articleHtml:"<p>Кароткі тэкст.</p>" },
          { id:"icons",   img:"icons",   title:"Іконы",            desc:"Пашанаваныя абразы.",     articleHtml:"<p>Кароткі тэкст.</p>" },
          { id:"white",   img:"white",   title:"Белы рух",         desc:"Памяць пра эміграцыю.",   articleHtml:"<p>Кароткі тэкст.</p>" },
          { id:"library", img:"library", title:"Бібліятэка",       desc:"Каталог і правілы.",      articleHtml:"<p>Кароткі тэкст.</p>" }
        ],
        footer: `87, boulevard Exelmans, Paris 75016<br />Метро: Exelmans (лінія 9)<br />✉️ <a id="email" href="mailto:ndsigne@gmail.com">ndsigne@gmail.com</a>`
      },

      ua: {
        logoLeft: ["Храм","Знамення"],
        logoRight: ["Пресвятої","Богородиці"],
        subheading: "Вікаріат імені Святих Марії Паризької та Олексія Южинського — Вселенський Патріархат",
        scheduleLabel1: "Розклад богослужінь",
        currentLabel: "ВЕРЕСЕНЬ",
        scheduleCurrent: [
          "<strong>6 субота, 18:00</strong>&nbsp;&ndash; Всеношна…",
          "<strong>7 неділя, 10:30</strong>&nbsp;&ndash; Божественна Літургія…"
        ],
        cards: [
          { id:"history", img:"history", title:"Історія парафії",  desc:"Російська діаспора в Парижі.", articleHtml:"<p>Короткий текст.</p>" },
          { id:"clergy",  img:"clergy",  title:"Клірики храму",    desc:"Настоятель і священик.",       articleHtml:"<p>Короткий текст.</p>" },
          { id:"school",  img:"school",  title:"Недільна школа",   desc:"Розклад, групи.",              articleHtml:"<p>Короткий текст.</p>" },
          { id:"icons",   img:"icons",   title:"Ікони",            desc:"Шановані образи.",             articleHtml:"<p>Короткий текст.</p>" },
          { id:"white",   img:"white",   title:"Білий рух",        desc:"Пам’ять еміграції.",           articleHtml:"<p>Короткий текст.</p>" },
          { id:"library", img:"library", title:"Бібліотека",       desc:"Каталог і правила.",           articleHtml:"<p>Короткий текст.</p>" }
        ],
        footer: `87, boulevard Exelmans, Paris 75016<br />Метро: Exelmans (лінія 9)<br />✉️ <a id="email" href="mailto:ndsigne@gmail.com">ndsigne@gmail.com</a>`
      }
    };

    /* ===================== DOM ===================== */
    const langSwitchers = document.querySelectorAll('.lang-switch span');
    const logoLeft = document.getElementById('logo-left');
    const logoRight = document.getElementById('logo-right');
    const subheading = document.getElementById('subheading');

    const scheduleBox   = document.getElementById('schedule-box');
    const scheduleLabel1= document.getElementById('schedule-label-1');
    const currentLabel  = document.getElementById('current-label');
    const monthA        = document.getElementById('month-a');
    const monthB        = document.getElementById('month-b');
    const listCompact   = document.getElementById('schedule-compact');
    const listA         = document.getElementById('list-a');
    const listB         = document.getElementById('list-b');
    const chevron       = document.getElementById('chevron');

    const cardsContainer= document.getElementById('cards');

    const footer = document.getElementById('footer');

    /* ===================== Дата/время (для расписания) ===================== */
    function parseDateTime(text, monthLabel) {
      const months = {
        'ЯНВАРЬ':0,'ФЕВРАЛЬ':1,'МАРТ':2,'АПРЕЛЬ':3,'МАЙ':4,'ИЮНЬ':5,'ИЮЛЬ':6,'АВГУСТ':7,'СЕНТЯБРЬ':8,'ОКТЯБРЬ':9,'НОЯБРЬ':10,'ДЕКАБРЬ':11,
        'JANVIER':0,'FÉVRIER':1,'MARS':2,'AVRIL':3,'MAI':4,'JUIN':5,'JUILLET':6,'AOÛT':7,'SEPTEMBRE':8,'OCTOBRE':9,'NOVEMBRE':10,'DÉCEMBRE':11,
        'СТУДЗЕНЬ':0,'ЛЮТЫ':1,'САКАВІК':2,'КРАСАВІК':3,'МАЙ':4,'ЧЭРВЕНЬ':5,'ЛІПЕНЬ':6,'ЖНІВЕНЬ':7,'ВЕРАСЕНЬ':8,'КАСТРЫЧНІК':9,'ЛІСТАПАД':10,'СНЕЖАНЬ':11,
        'СІЧЕНЬ':0,'ЛЮТИЙ':1,'БЕРЕЗЕНЬ':2,'КВІТЕНЬ':3,'ТРАВЕНЬ':4,'ЧЕРВЕНЬ':5,'ЛИПЕНЬ':6,'СЕРПЕНЬ':7,'ВЕРЕСЕНЬ':8,'ЖОВТЕНЬ':9,'ЛИСТОПАД':10,'ГРУДЕНЬ':11
      };
      const m = text.match(/<strong>(\d+)[^\d]*(?:, )?(\d{1,2}):(\d{2})<\/strong>/i);
      if (!m) return null;
      const day = +m[1], hour = +m[2], minute = +m[3];
      const month = months[(monthLabel||'').toUpperCase()] ?? new Date().getMonth();
      const now = new Date();
      let year = now.getFullYear();
      if (month < now.getMonth() - 1) year += 1;
      return new Date(year, month, day, hour, minute);
    }
    function upcomingOnly(list, monthLabel) {
      const now = new Date();
      return (list||[])
        .map(html => ({ html, dt: parseDateTime(html, monthLabel) }))
        .filter(x => x.dt && x.dt.getTime() >= (now.getTime() - 2*60*60*1000))
        .sort((a,b) => a.dt - b.dt);
    }
    function pickNextN(futA, futB, n=2) {
      return futA.concat(futB).sort((a,b)=>a.dt-b.dt).slice(0,n).map(x=>x.html);
    }

    /* ===================== Рендер карточек ===================== */
    function renderCards(lang){
      const items = translations[lang].cards;
      const html = items.map(c=>`
        <article class="card" data-id="${c.id}" tabindex="0" role="button" aria-label="${c.title}">
          <div class="card-media">
            <div class="media-inner">
              <picture>
                <source type="image/webp" srcset="assets/cards/${c.img}.webp">
                <img src="assets/cards/${c.img}.jpg" alt="${c.title}">
              </picture>
            </div>
          </div>
          <div class="card-body">
            <h3>${c.title}</h3>
            <p>${c.desc}</p>
          </div>
        </article>
      `).join('');
      cardsContainer.innerHTML = html;
    }

    /* ===================== Модал: фото слева, «лист» скролл, «Читать полностью» ===================== */
    const modal = document.getElementById('card-modal');
    const modalTitle = document.getElementById('modal-title');
    const modalHero = document.getElementById('modal-hero');
    const modalBody = document.getElementById('modal-body');
    const modalClose = document.getElementById('modal-close');
    let currentLang = 'ru';

    // Длинные статьи клади в content/<язык>/<id>.html (например, content/ru/history.html).
    async function openCard(id){
      const c = translations[currentLang].cards.find(x=>x.id===id);
      if (!c) return;

      modalTitle.textContent = c.title;

      // лид-фото слева (уменьшено)
      const leadHTML = `
        <figure class="lead-figure">
          <picture>
            <source type="image/webp" srcset="assets/cards/${c.img}.webp">
            <img src="assets/cards/${c.img}.jpg" alt="${c.title}">
          </picture>
        </figure>`;

      modalHero.innerHTML = ""; // верхний hero не используем

      // основной текст
      const articleUrl = `content/${currentLang}/${id}.html`;
      let article = c.articleHtml || "<p>Текст временно недоступен.</p>";
      try {
        const res = await fetch(articleUrl, { cache: "no-store" });
        if (res.ok) article = await res.text();
      } catch(e){ /* фолбэк остаётся */ }

      // «Читать полностью» — пробуем pages/<lang>/<id>.html, иначе content/...
      let fullUrl = `pages/${currentLang}/${id}.html`;
      try {
        const head = await fetch(fullUrl, { method:"HEAD" });
        if (!head.ok) throw 0;
      } catch(_){
        fullUrl = articleUrl;
      }

      modalBody.innerHTML = leadHTML + article +
        `<p class="read-more"><a href="${fullUrl}" target="_blank" rel="noopener">Читать полностью&nbsp;→</a></p>`;

      modal.classList.add('open');
      document.body.classList.add('modal-open');
      modal.setAttribute('aria-hidden','false');
      modalClose.focus();
    }
    function closeModal(){
      modal.classList.remove('open');
      document.body.classList.remove('modal-open');
      modal.setAttribute('aria-hidden','true');
    }
    modalClose.addEventListener('click', closeModal);
    modal.addEventListener('click', (e)=>{ if (e.target === modal) closeModal(); });
    document.addEventListener('keydown', (e)=>{ if (e.key==='Escape' && modal.classList.contains('open')) closeModal(); });
    cardsContainer.addEventListener('click', e=>{
      const card = e.target.closest('.card'); if (!card) return;
      openCard(card.dataset.id);
    });
    cardsContainer.addEventListener('keydown', e=>{
      if ((e.key==='Enter' || e.key===' ') && e.target.closest('.card')) {
        e.preventDefault();
        openCard(e.target.closest('.card').dataset.id);
      }
    });

    /* ===================== Хранилище расписания ===================== */
    const STORAGE_KEYS = { ru:'schedule.ru', fr:'schedule.fr', by:'schedule.by', ua:'schedule.ua' };
    const STORAGE_VERSION = 2;
    function saveSeed(lang, t) {
      const data = { _lang:lang, _ver:STORAGE_VERSION,
        logoLeft:t.logoLeft, logoRight:t.logoRight, subheading:t.subheading,
        scheduleLabel1:t.scheduleLabel1, currentLabel:t.currentLabel, scheduleCurrent:t.scheduleCurrent,
        nextLabel:t.nextLabel, scheduleNext:t.scheduleNext, footer:t.footer
      };
      try { localStorage.setItem(STORAGE_KEYS[lang], JSON.stringify(data)); } catch(e){}
      return data;
    }
    function seedLocalStorageOnce() {
      Object.keys(STORAGE_KEYS).forEach(lang=>{
        if (!localStorage.getItem(STORAGE_KEYS[lang])) saveSeed(lang, translations[lang]);
      });
    }
    function loadLangData(lang) {
      const defaults = translations[lang];
      let stored = null;
      try { stored = JSON.parse(localStorage.getItem(STORAGE_KEYS[lang])); } catch(e) { stored = null; }
      if (!stored || stored._ver !== STORAGE_VERSION) return saveSeed(lang, defaults);
      let data = { ...defaults, ...stored };
      ['scheduleCurrent','scheduleNext'].forEach(k=>{
        if (!Array.isArray(data[k]) || data[k].length===0) data[k] = defaults[k];
      });
      return data;
    }

    /* ===================== Футер-админка ===================== */
    function injectAdminGearIntoFooter(html) {
      const fixed = html.replace(/75016(?![^<]*>)/, '75016 <a class="admin-gear" href="admin.html" title="Админ">&#9881;</a>');
      footer.innerHTML = fixed;
    }

    /* ===================== Рендер расписания ===================== */
    let expanded = false;

    function renderCompact(currentLabelText, nextTwo) {
      currentLabel.style.display = '';
      currentLabel.innerText = currentLabelText;
      listCompact.style.display = '';
      listCompact.innerHTML = nextTwo.length ? ("<li>"+nextTwo.join("</li><li>")+"</li>") : "";

      monthA.style.display = 'none'; listA.style.display = 'none';
      monthB.style.display = 'none'; listB.style.display = 'none';
    }

    function renderFull(labelA, listAItems, labelB, listBItems) {
      currentLabel.style.display = 'none';
      listCompact.style.display = 'none';

      monthA.style.display = '';  monthA.innerText = labelA;
      listA.style.display  = '';  listA.innerHTML = listAItems.length ? ("<li>"+listAItems.join("</li><li>")+"</li>") : "";

      monthB.style.display = '';  monthB.innerText = labelB;
      listB.style.display  = '';  listB.innerHTML = listBItems.length ? ("<li>"+listBItems.join("</li><li>")+"</li>") : "";
    }

    function setLang(lang) {
      currentLang = lang;
      document.querySelectorAll('.lang-switch span').forEach(s=>s.classList.remove('active'));
      document.querySelector(`.lang-switch span[data-lang="${lang}"]`).classList.add('active');

      const data = loadLangData(lang);
      logoLeft.innerHTML  = `<span>${data.logoLeft[0]}</span><span>${data.logoLeft[1]}</span>`;
      logoRight.innerHTML = `<span>${data.logoRight[0]}</span><span>${data.logoRight[1]}</span>`;
      subheading.innerText = data.subheading;
      scheduleLabel1.innerText = data.scheduleLabel1;

      const futCur  = upcomingOnly(data.scheduleCurrent, data.currentLabel);
      const futNext = upcomingOnly(data.scheduleNext,  data.nextLabel);

      if (!expanded) {
        const nextTwo = pickNextN(futCur, futNext, 2);
        renderCompact(data.currentLabel, nextTwo);
      } else {
        renderFull(data.currentLabel, futCur.map(x=>x.html), data.nextLabel, futNext.map(x=>x.html));
      }

      const totalFuture = futCur.length + futNext.length;
      chevron.style.display = totalFuture > 2 ? 'block' : 'none';
      chevron.textContent = expanded ? '▲' : '▼';
      scheduleBox.setAttribute('aria-expanded', String(expanded));
      scheduleBox.setAttribute('aria-label', expanded ? 'Свернуть расписание' : 'Показать всё расписание');

      renderCards(lang);
      injectAdminGearIntoFooter(data.footer);
    }

    /* ===================== Init + handlers ===================== */
    seedLocalStorageOnce();

    // переключение языков
    langSwitchers.forEach(s => s.onclick = () => { expanded = false; setLang(s.dataset.lang); });

    // кликабельная коробка расписания
    scheduleBox.addEventListener('click', (e) => {
      if (e.target.closest('a')) return;
      if (chevron.style.display === 'none') return;
      expanded = !expanded;
      setLang(currentLang);
    });
    scheduleBox.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        if (chevron.style.display !== 'none') {
          expanded = !expanded;
          setLang(currentLang);
        }
      }
    });

    setLang('ru');
  </script>
</body>
</html>
